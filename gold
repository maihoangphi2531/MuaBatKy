-- Danh sách người bán
local shopData = {
    {seller = "pandaboiis54"},
    {seller = "StevensElijah33"},
    {seller = "lalaa13123"},
    {seller = "lalaa1756"},
}

-- Tên món đồ cần mua và giá ưu tiên
local itemName = "DeconstructionStone"
local priorityPrice = 99999999 -- Giá ưu tiên

-- Thời gian chờ giữa các lần lặp (giây)
local delayBetweenLoops = 0.01

-- Place ID để teleport
local targetPlaceId = 4310463616

-- Hàm thực hiện mua tất cả các món DeconstructionStone
local function buyItemsFromShop(shopOwnerName)
    -- Tìm folder shop của chủ shop trong ReplicatedStorage
    local playerShops = game:GetService("ReplicatedStorage"):WaitForChild("PlayerShops")
    local shopFolder = playerShops:FindFirstChild(shopOwnerName)
    if not shopFolder then
        return false
    end

    -- Truy cập folder SellShop và Items
    local sellShopFolder = shopFolder:FindFirstChild("SellShop")
    if not sellShopFolder then
        return false
    end

    local itemsFolder = sellShopFolder:FindFirstChild("Items")
    if not itemsFolder then
        return false
    end

    -- Phân loại các món dựa trên giá
    local priorityItems = {}
    local otherItems = {}

    for _, stone in pairs(itemsFolder:GetChildren()) do
        if stone.Name == itemName then
            local askingPrice = stone:FindFirstChild("AskingPrice")
            if askingPrice and askingPrice:IsA("IntValue") then
                if askingPrice.Value == priorityPrice then
                    table.insert(priorityItems, stone) -- Món ưu tiên
                else
                    table.insert(otherItems, stone) -- Món khác
                end
            end
        end
    end

    -- Hàm mua từng món
    local function buyStone(stone)
        local shopOwner = game:GetService("Players"):FindFirstChild(shopOwnerName)
        if not shopOwner then
            return false
        end

        local success = pcall(function()
            game:GetService("ReplicatedStorage")
                :WaitForChild("Shared")
                :WaitForChild("Shop")
                :WaitForChild("Buy")
                :InvokeServer(shopOwner, stone)
        end)

        return success
    end

    -- Mua các món ưu tiên trước
    local stonesBought = 0
    for _, stone in ipairs(priorityItems) do
        if buyStone(stone) then
            stonesBought = stonesBought + 1
        end
    end

    -- Mua các món khác sau
    for _, stone in ipairs(otherItems) do
        if buyStone(stone) then
            stonesBought = stonesBought + 1
        end
    end

    return stonesBought > 0
end

-- Vòng lặp chạy liên tục
while true do
    local itemBought = false -- Đánh dấu nếu đã mua thành công
    for _, shop in ipairs(shopData) do
        if buyItemsFromShop(shop.seller) then
            itemBought = true
            break
        end
    end

    -- Nếu đã mua thành công, thực hiện teleport
    if itemBought then
        pcall(function()
            game:GetService("TeleportService"):Teleport(targetPlaceId)
        end)
        break -- Dừng vòng lặp sau khi teleport
    end

    -- Chờ trước khi lặp lại
    task.wait(delayBetweenLoops)
end
